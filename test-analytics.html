<!DOCTYPE html>
<html>
<head>
    <title>Analytics Debug Test</title>
</head>
<body>
    <h1>Analytics Debug Test</h1>
    <button onclick="testAnalytics()">Test Analytics</button>
    <button onclick="addTestData()">Add Test Data</button>
    <button onclick="checkElements()">Check Elements</button>
    <div id="results"></div>

    <script>
        function testAnalytics() {
            const results = document.getElementById('results');
            
            // Check if analytics objects exist
            if (window.financialAnalytics) {
                results.innerHTML += '<p style="color: green;">✅ financialAnalytics object exists</p>';
                
                // Try to refresh
                try {
                    window.financialAnalytics.refreshAnalytics();
                    results.innerHTML += '<p style="color: green;">✅ Analytics refresh called</p>';
                } catch (e) {
                    results.innerHTML += `<p style="color: red;">❌ Analytics refresh failed: ${e}</p>`;
                }
            } else {
                results.innerHTML += '<p style="color: red;">❌ financialAnalytics object not found</p>';
            }
            
            // Check if dashboard exists
            if (window.dashboard) {
                results.innerHTML += '<p style="color: green;">✅ dashboard object exists</p>';
                results.innerHTML += `<p>Dashboard expenses: ${window.dashboard.expenses ? window.dashboard.expenses.length : 'undefined'}</p>`;
            } else {
                results.innerHTML += '<p style="color: red;">❌ dashboard object not found</p>';
            }
            
            // Check localStorage
            const expenses = JSON.parse(localStorage.getItem('expenses')) || [];
            results.innerHTML += `<p>LocalStorage expenses: ${expenses.length}</p>`;
        }

        function addTestData() {
            const testExpense = {
                id: 'test_' + Date.now(),
                amount: 1000,
                category: 'food',
                description: 'Test expense',
                date: new Date().toISOString().split('T')[0]
            };
            
            const expenses = JSON.parse(localStorage.getItem('expenses')) || [];
            expenses.unshift(testExpense);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            
            document.getElementById('results').innerHTML += '<p style="color: green;">✅ Test expense added</p>';
            
            // Try to refresh dashboard if it exists
            if (window.dashboard) {
                window.dashboard.expenses = expenses;
                window.dashboard.updateDashboard();
            }
            
            // Try to refresh analytics
            if (window.financialAnalytics) {
                window.financialAnalytics.refreshAnalytics();
            }
        }

        function checkElements() {
            const elementIds = ['overviewTotalSpent', 'overviewDailyAvg', 'overviewTransactions', 'overviewChart'];
            const results = document.getElementById('results');
            
            results.innerHTML += '<h3>Element Check:</h3>';
            elementIds.forEach(id => {
                const element = document.getElementById(id);
                results.innerHTML += `<p>${id}: ${element ? 'Found' : 'NOT FOUND'}</p>`;
            });
        }

        // Auto-run tests
        setTimeout(() => {
            testAnalytics();
            checkElements();
        }, 2000);
    </script>
</body>
</html>
