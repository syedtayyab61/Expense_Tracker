<!DOCTYPE html>
<html>
<head>
    <title>Complete Debug Test</title>
</head>
<body>
    <h1>Complete Expense Tracker Debug</h1>
    
    <div style="margin: 20px 0;">
        <button onclick="testLocalStorage()">Test localStorage</button>
        <button onclick="testManualAdd()">Test Manual Add</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="viewStorage()">View Storage</button>
    </div>
    
    <div id="results"></div>

    <script>
        function testLocalStorage() {
            const results = document.getElementById('results');
            results.innerHTML += '<h3>localStorage Test:</h3>';
            
            try {
                // Test write
                const testData = {test: 'value', timestamp: Date.now()};
                localStorage.setItem('test_expense_tracker', JSON.stringify(testData));
                results.innerHTML += '<p style="color: green;">‚úÖ localStorage write successful</p>';
                
                // Test read
                const retrieved = JSON.parse(localStorage.getItem('test_expense_tracker'));
                if (retrieved && retrieved.test === 'value') {
                    results.innerHTML += '<p style="color: green;">‚úÖ localStorage read successful</p>';
                } else {
                    results.innerHTML += '<p style="color: red;">‚ùå localStorage read failed</p>';
                }
                
                // Clean up
                localStorage.removeItem('test_expense_tracker');
                results.innerHTML += '<p style="color: blue;">üßπ Test data cleaned up</p>';
                
            } catch (error) {
                results.innerHTML += `<p style="color: red;">‚ùå localStorage error: ${error}</p>`;
            }
        }
        
        function testManualAdd() {
            const results = document.getElementById('results');
            results.innerHTML += '<h3>Manual Add Test:</h3>';
            
            try {
                // Create test expense
                const testExpense = {
                    id: 'manual_test_' + Date.now(),
                    amount: 500,
                    category: 'food',
                    description: 'Manual test expense',
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date().toISOString()
                };
                
                // Get existing expenses
                const existing = JSON.parse(localStorage.getItem('expenses')) || [];
                results.innerHTML += `<p>Existing expenses: ${existing.length}</p>`;
                
                // Add new expense
                existing.unshift(testExpense);
                
                // Save back
                localStorage.setItem('expenses', JSON.stringify(existing));
                
                // Verify
                const saved = JSON.parse(localStorage.getItem('expenses')) || [];
                if (saved.length === existing.length && saved[0].id === testExpense.id) {
                    results.innerHTML += '<p style="color: green;">‚úÖ Manual expense add successful</p>';
                    results.innerHTML += `<p>New total: ${saved.length} expenses</p>`;
                    results.innerHTML += `<p>Latest expense: ${JSON.stringify(saved[0])}</p>`;
                } else {
                    results.innerHTML += '<p style="color: red;">‚ùå Manual expense add failed</p>';
                }
                
            } catch (error) {
                results.innerHTML += `<p style="color: red;">‚ùå Manual add error: ${error}</p>`;
            }
        }
        
        function clearStorage() {
            localStorage.removeItem('expenses');
            document.getElementById('results').innerHTML += '<p style="color: orange;">üóëÔ∏è Expenses storage cleared</p>';
        }
        
        function viewStorage() {
            const expenses = JSON.parse(localStorage.getItem('expenses')) || [];
            const results = document.getElementById('results');
            results.innerHTML += '<h3>Current Storage:</h3>';
            results.innerHTML += `<p><strong>Total expenses:</strong> ${expenses.length}</p>`;
            
            if (expenses.length > 0) {
                results.innerHTML += '<h4>Recent expenses:</h4>';
                expenses.slice(0, 5).forEach((exp, index) => {
                    results.innerHTML += `<p>${index + 1}. ‚Çπ${exp.amount} - ${exp.category} - ${exp.description} (${exp.date})</p>`;
                });
            }
            
            results.innerHTML += `<details><summary>Raw data</summary><pre>${JSON.stringify(expenses, null, 2)}</pre></details>`;
        }
        
        // Auto-run basic tests
        setTimeout(() => {
            testLocalStorage();
            viewStorage();
        }, 500);
    </script>
</body>
</html>
